require "test_helper"

class TeachersControllerTest < ActionDispatch::IntegrationTest
  def setup
    # kollegium_mock_file = File.open('kollegium_mock.html')
    # kollegium_mock = kollegium_mock_file.read

    stub_request(:get, 'https://elisabethschule.de/schulgemeinde/kollegium/').
      with(body: '<table cellpadding="5" cellspacing="5" style="height:9px; width:100%" class="contenttable"> <tbody> <tr class="align-left thead"> <th class="text-left" scope="col">Name</th> <th scope="col">Kürzel</th> <th scope="col">Fächer</th> </tr> <tr> <td>Austen, Johanna</td> <td class="text-center">AUST</td> <td>SP, REV</td> </tr> <tr> <td>Bahmer, Caroline</td> <td class="text-center">BURC</td> <td>BIO, KU</td> </tr> <tr> <td>Balzer, Christina</td> <td class="text-center">BALZ</td> <td>B, M</td> </tr> <tr> <td>Bark, Gunhild</td> <td class="text-center">BARK</td> <td>D, POW</td> </tr> <tr> <td>Bechtler, Marietta</td> <td class="text-center">BECH</td> <td>BIO, CH</td> </tr> <tr> <td>Bier, Patricia</td> <td class="text-center">BIER</td> <td>D, ETH</td> </tr> <tr> <td>Bierau, Carolin</td> <td class="text-center">BIRA</td> <td>E, SPA</td> </tr> <tr> <td>Blick, Kirsten</td> <td class="text-center">BLIC</td> <td>E, G</td> </tr> <tr> <td>Bode, Dr. Matthias</td> <td class="text-center">BODE</td> <td>E, G</td> </tr> <tr> <td>Boll, Inge</td> <td class="text-center">BOLL</td> <td>KU</td> </tr> <tr> <td>Bouley, Lucie</td> <td class="text-center">BOUL</td> <td>D, F</td> </tr> <tr> <td>Buffler, Udo</td> <td class="text-center">BUFF</td> <td>KU, E</td> </tr> <tr> <td>Burkholz, Matthias</td> <td class="text-center">BURK</td> <td>D, POWI</td> </tr> <tr> <td>Busse, Stephan</td> <td class="text-center">BUSS</td> <td>EK, ETH</td> </tr> <tr> <td>Capra, Lucy</td> <td class="text-center">CAPR</td> <td>E, POWI</td> </tr> <tr> <td>Closmann, Andrea</td> <td class="text-center">CLOS</td> <td>E, SPO</td> </tr> <tr> <td>Cokokur, Ronja</td> <td class="text-center">COKO</td> <td>D, G</td> </tr> <tr> <td>deJong, Barbara</td> <td class="text-center">JONG</td> <td>BIO, CH</td> </tr> <tr> <td>Diedrich, Markus</td> <td class="text-center">DIED</td> <td>DS, E, G</td> </tr> <tr> <td>Dirks, Fabian</td> <td class="text-center">DIRK</td> <td>POW, SPO</td> </tr> <tr> <td>Ditter, Philipp</td> <td class="text-center">DITT</td> <td>E, F</td> </tr> <tr> <td>Dörr, Christine</td> <td class="text-center">DÖRR</td> <td>E, EK</td> </tr> <tr> <td>Drude, Eva</td> <td class="text-center">DRUD</td> <td>BIO, D</td> </tr> <tr> <td>Eimer, Frauke</td> <td class="text-center">EIME</td> <td>M, PH</td> </tr> <tr> <td>Engel, Sabina</td> <td class="text-center">ENGE</td> <td>DSP, E, F</td> </tr> <tr> <td>Faschingbauer, Tamara</td> <td class="text-center">FASH</td> <td>D, E</td> </tr> <tr> <td>Follmann, Nicole</td> <td class="text-center">FOLL</td> <td>M, BIO</td> </tr> <tr> <td>Friedrich, Florian</td> <td class="text-center">FRIE</td> <td>G, POWI</td> </tr> <tr> <td>Gausmann, Frank</td> <td class="text-center">GAUS</td> <td>G</td> </tr> <tr> <td>Gebhardt, Stephanie</td> <td class="text-center">GEBH</td> <td>DS</td> </tr> <tr> <td>Gerling, Stefanie</td> <td class="text-center">GERL</td> <td>D, SPO</td> </tr> <tr> <td>Glass, Eddy</td> <td class="text-center">GLAS</td> <td>ETHI, SPO</td> </tr> <tr> <td>Göbel, Johannes</td> <td class="text-center">GÖBE</td> <td>F, ITA, L</td> </tr> <tr> <td>Haizmann, Nicole</td> <td class="text-center">HAIZ</td> <td>F, POW</td> </tr> <tr> <td>Hankammer, Stephanie</td> <td class="text-center">HANK</td> <td>E, EK, SPA</td> </tr> <tr> <td>Hannig, Janina</td> <td class="text-center">HANN</td> <td>F, SPA</td> </tr> <tr> <td>Harder, Dr. Ulrike</td> <td class="text-center">HARD</td> <td>D, G</td> </tr> <tr> <td>Heidenreich, Jana</td> <td class="text-center">HEID</td> <td>BIO, EK</td> </tr> <tr> <td>Helmling, Marlene</td> <td class="text-center">HELM</td> <td>D, E, DS</td> </tr> <tr> <td>Herget, Max</td> <td class="text-center">HERG</td> <td>PH, REV</td> </tr> <tr> <td>Hesse, Dr. Philipp</td> <td class="text-center">HESS</td> <td>M, PH</td> </tr> <tr> <td>Höhle, Astrid</td> <td class="text-center">HÖHL</td> <td>CH, M</td> </tr> <tr> <td>Hohmann, Luisa&nbsp;</td> <td class="text-center">HOHM</td> <td>G, DS, SPA</td> </tr> <tr> <td>Hölscher-Bachmann, Frank</td> <td class="text-center">HÖLS</td> <td>D, MU</td> </tr> <tr> <td>Hühn, Heike</td> <td class="text-center">HÜHN</td> <td>SOZ.-PÄD</td> </tr> <tr> <td>Hüller, Anja</td> <td class="text-center">HÜLL</td> <td>M, SPO</td> </tr> <tr> <td>Hunsdorfer, Susanne</td> <td class="text-center">HUNS</td> <td>M, PH</td> </tr> <tr> <td>Jacobi, Johanna</td> <td class="text-center">JACO</td> <td>D, SPO</td> </tr> <tr> <td>Jakobi, Klemens</td> <td class="text-center">JAKO</td> <td>CH, SPO</td> </tr> <tr> <td>Jansen, Niels</td> <td class="text-center">JANS</td> <td>KU</td> </tr> <tr> <td>Joeres, Jan</td> <td class="text-center">JOER</td> <td>F, SPO</td> </tr> <tr> <td>Jung, Sonja</td> <td class="text-center">JUNG</td> <td>D, ETHI, RU</td> </tr> <tr> <td>Kamionka, Lisa-Maria</td> <td class="text-center">KAMI</td> <td>E, ETHI, G</td> </tr> <tr> <td>Kanngießer, Julia</td> <td class="text-center">KANN</td> <td>E, SPO</td> </tr> <tr> <td>Keding, Bärbel</td> <td class="text-center">KEDI</td> <td>E, ETH, SPA</td> </tr> <tr> <td>Kind, Paul</td> <td class="text-center">KIND</td> <td>F</td> </tr> <tr> <td>Koberstein, Oliver</td> <td class="text-center">KOBE</td> <td>E, EK</td> </tr> <tr> <td>Koch, Hartmuth</td> <td class="text-center">KOCH</td> <td>ETHI, L, RKA</td> </tr> <tr> <td>Krämer, Michaela</td> <td class="text-center">KRÄM</td> <td>E, SPA</td> </tr> <tr> <td>Kreis, Günter</td> <td class="text-center">KREI</td> <td>M, PH</td> </tr> <tr> <td>Kremper, Dr. Alexander</td> <td class="text-center">KREM</td> <td>M, PH</td> </tr> <tr> <td>Krieb, Jennifer</td> <td class="text-center">KRIE</td> <td>POWI, SPO</td> </tr> <tr> <td>Kriegs, Leon</td> <td class="text-center">KRIG</td> <td>BIO, CH</td> </tr> <tr> <td>Kubusch, Karolina</td> <td class="text-center">KUBU</td> <td>L, SPO, D</td> </tr> <tr> <td>Ladrón, Patricio</td> <td class="text-center">LADR</td> <td>SPA, SPO</td> </tr> <tr> <td>Lange, Clemens</td> <td class="text-center">LANG</td> <td>G, POW</td> </tr> <tr> <td>Liedtke, Sabine</td> <td class="text-center">LIED</td> <td>M, REV</td> </tr> <tr> <td>Löffler, Robin</td> <td class="text-center">LÖFF</td> <td>POWI, SPO</td> </tr> <tr> <td>Luigs, Nicole</td> <td class="text-center">LUIG</td> <td>D, DSP, F</td> </tr> <tr> <td>Malkus, Silke</td> <td class="text-center">MALK</td> <td>RKA, SPO</td> </tr> <tr> <td>Merle, Gunnar</td> <td class="text-center">MERL</td> <td>G, D, ETH</td> </tr> <tr> <td>Michels, Thorsten</td> <td class="text-center">MICH</td> <td>B, POW</td> </tr> <tr> <td>Miemelt, Evelyn</td> <td class="text-center">MIEM</td> <td>CH, M</td> </tr> <tr> <td>Müller, Marius</td> <td class="text-center">MÜLR</td> <td>CH, M</td> </tr> <tr> <td>Neidel, Frank-Dietrich</td> <td class="text-center">NEID</td> <td>MU, POWI</td> </tr> <tr> <td>Nieder, Almuth</td> <td class="text-center">NIDR</td> <td>BIO, E</td> </tr> <tr> <td>Niederprüm, Tobias</td> <td class="text-center">NIED</td> <td>EK, POWI</td> </tr> <tr> <td>Nolte, Jana-Marleen</td> <td class="text-center">NOLT</td> <td>BIO, KU</td> </tr> <tr> <td>Perle, Lars</td> <td class="text-center">PERL</td> <td>M, INFO, POWI</td> </tr> <tr> <td>Pflüger, Tanja</td> <td class="text-center">PFLÜ</td> <td>E, POWI</td> </tr> <tr> <td>Purkl, Dr. Stefan</td> <td class="text-center">PURK</td> <td>CH, PH</td> </tr> <tr> <td>Purtauf, Dr. Tobias</td> <td class="text-center">PURT</td> <td>BIO, DSP, EK</td> </tr> <tr> <td>Reitmeier, Nino</td> <td class="text-center">REIT</td> <td>E, G</td> </tr> <tr> <td>Ritter, Thomas</td> <td class="text-center">RITT</td> <td>INFO, M, PH</td> </tr> <tr> <td>Rösner, Dr. Marco</td> <td class="text-center">RÖSN</td> <td>G, M</td> </tr> <tr> <td>Rühling, Hannah</td> <td class="text-center">RÜHL</td> <td>CH, BIO</td> </tr> <tr> <td>Rupp, Martina</td> <td class="text-center">RUPP</td> <td>E, G</td> </tr> <tr> <td>Scherer, Fabienne</td> <td class="text-center">SHER</td> <td>D, M</td> </tr> <tr> <td>Scherer, Jacqueline</td> <td class="text-center">SCHE</td> <td>B, L</td> </tr> <tr> <td>Schmenk, Dr. Nicole</td> <td class="text-center">SMNK</td> <td>D, G</td> </tr> <tr> <td>Schmidt, Maik</td> <td class="text-center">SMIT</td> <td>CH, POWI</td> </tr> <tr> <td>Schmidt-Bietz, Petra</td> <td class="text-center">SBIZ</td> <td>M, SPO</td> </tr> <tr> <td>Schoof, Helmut</td> <td class="text-center">SHOF</td> <td>M, MU, REV</td> </tr> <tr> <td>Schütt, Dr. Tanja</td> <td class="text-center">SÜTT</td> <td>D, SPO</td> </tr> <tr> <td>Sechi, Stefania</td> <td class="text-center">SECH</td> <td>ETHI, MU</td> </tr> <tr> <td>Seiffert, Ingrid</td> <td class="text-center">SEIF</td> <td>E, F</td> </tr> <tr> <td>Selinka, Michael</td> <td class="text-center">SELI</td> <td>ETHI, POWI, SPO</td> </tr> <tr> <td>Sener, Tülay</td> <td class="text-center">SENE</td> <td>B, D</td> </tr> <tr> <td>Shakour, Amari</td> <td class="text-center">SHAK</td> <td>D, ETH</td> </tr> <tr> <td>Striet, Valentine</td> <td class="text-center">STRI</td> <td>D, F</td> </tr> <tr> <td>Theiß, Inga</td> <td class="text-center">THEI</td> <td>D, G</td> </tr> <tr> <td>Trautwein, Ute</td> <td class="text-center">TRAU</td> <td>D, REV</td> </tr> <tr> <td>Triebstein, Martin</td> <td class="text-center">TRIE</td> <td>CH, SPO</td> </tr> <tr> <td>Tschammer, Johanna</td> <td class="text-center">TSCH</td> <td>BIO, REV</td> </tr> <tr> <td>Ullrich, Mathis</td> <td class="text-center">ULLR</td> <td>D, G</td> </tr> <tr> <td>Wachtel, Steffen</td> <td class="text-center">WACH</td> <td>M, PH</td> </tr> <tr> <td>Weber, Amelie</td> <td class="text-center">WEBA</td> <td>BIO, EK</td> </tr> <tr> <td>Wenner, Luisa</td> <td class="text-center">WENN</td> <td>F, REV</td> </tr> <tr> <td>Weyer, Rüdiger</td> <td class="text-center">WEYR</td> <td>M, REV</td> </tr> <tr> <td>Wiemer, Renate</td> <td class="text-center">WIEM</td> <td>D, L</td> </tr> <tr> <td>Wolter-Schober, Jacqueline</td> <td class="text-center">WOLT</td> <td>D, ETHI, G</td> </tr> <tr> <td>Zwickert, René-Jörg</td> <td class="text-center">ZWIC</td> <td>E, SPO</td> </tr> </tbody> </table>')
  end

  test "getting the right Teacher for an abbrevation" do
    get "/api/v1/teachers/AUST"

    assert_response :success

    teacher = @response.parsed_body
    expected_response = { "name" => "Austen, Johanna", "abbreviation" => "AUST", "subjects" => "SP, REV" }

    assert_equal expected_response["name"], teacher["name"]
    assert_equal expected_response["abbreviation"], teacher["abbreviation"]
    assert_equal expected_response["subjects"], teacher["subjects"]
  end

  test "getting 404 when no teacher is found" do
    get "/api/v1/teachers/ABCDEFGHIJKL"
    assert_response :missing
  end
end
